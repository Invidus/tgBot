import axios from 'axios';

// ĞĞ´Ğ¼Ğ¸Ğ½ username (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑƒĞºĞ°Ğ·Ğ°Ñ‚ÑŒ Ğ½ĞµÑĞºĞ¾Ğ»ÑŒĞºĞ¾ Ñ‡ĞµÑ€ĞµĞ· Ğ·Ğ°Ğ¿ÑÑ‚ÑƒÑ)
// ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: 'DmitriyBuyanov' Ğ¸Ğ»Ğ¸ 'DmitriyBuyanov, admin2, admin3'
const ADMIN_USERNAMES_STRING = 'DmitriyBuyanov';

/**
 * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ÑĞ¿Ğ¸ÑĞ¾Ğº Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ² Ğ¸Ğ· ÑÑ‚Ñ€Ğ¾ĞºĞ¸
 */
const getAdminUsernames = () => {
  return ADMIN_USERNAMES_STRING
    .split(',')
    .map(name => name.trim().replace('@', '').toLowerCase())
    .filter(name => name.length > 0);
};

/**
 * ĞŸÑ€Ğ¾Ğ²ĞµÑ€ÑĞµÑ‚, ÑĞ²Ğ»ÑĞµÑ‚ÑÑ Ğ»Ğ¸ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½Ğ¸ÑÑ‚Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ¾Ğ¼
 */
export const isAdmin = (username) => {
  if (!username) return false;
  const cleanUsername = username.replace('@', '').toLowerCase();
  const adminUsernames = getAdminUsernames();
  return adminUsernames.includes(cleanUsername);
};

/**
 * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ ĞºĞ»Ğ°Ğ²Ğ¸Ğ°Ñ‚ÑƒÑ€Ñƒ Ğ³Ğ»Ğ°Ğ²Ğ½Ğ¾Ğ³Ğ¾ Ğ¼ĞµĞ½Ñ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»Ğ¸
 */
export const getAdminMainKeyboard = () => {
  return {
    reply_markup: {
      inline_keyboard: [
        [{ text: 'ğŸ“Š Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ', callback_data: 'admin_get_user_info' }],
        [{ text: 'ğŸ Ğ’Ñ‹Ğ´Ğ°Ñ‚ÑŒ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ğµ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑÑ‹', callback_data: 'admin_set_free_requests' }],
        [{ text: 'ğŸ’³ Ğ’Ñ‹Ğ´Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºÑƒ', callback_data: 'admin_set_subscription' }],
        [{ text: 'âŒ Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ°Ğ´Ğ¼Ğ¸Ğ½-Ğ¿Ğ°Ğ½ĞµĞ»ÑŒ', callback_data: 'admin_close' }]
      ]
    }
  };
};

/**
 * ĞŸĞ¾Ğ»ÑƒÑ‡Ğ°ĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ Ñ‡ĞµÑ€ĞµĞ· API
 */
const getUserInfoFromAPI = async (databaseServiceUrl, username) => {
  try {
    const response = await axios.get(`${databaseServiceUrl}/users/username/${username}/info`, {
      timeout: 10000
    });
    return response.data.userInfo || null;
  } catch (error) {
    console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ:', error.message);
    return null;
  }
};

/**
 * Ğ¤Ğ¾Ñ€Ğ¼Ğ°Ñ‚Ğ¸Ñ€ÑƒĞµÑ‚ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¿Ñ€Ğ°Ğ²ĞºĞ¸
 */
export const formatUserInfo = (userInfo) => {
  if (!userInfo) {
    return 'âŒ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½.';
  }

  let message = `ğŸ“Š **Ğ˜Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ñ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ**\n\n`;
  message += `ğŸ‘¤ Username: @${userInfo.username || 'Ğ½Ğµ ÑƒĞºĞ°Ğ·Ğ°Ğ½'}\n`;
  message += `ğŸ†” Chat ID: ${userInfo.chatId}\n`;
  message += `ğŸ Ğ‘ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²: ${userInfo.freeRequests}\n\n`;

  if (userInfo.hasSubscription) {
    message += `âœ… **ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ°ĞºÑ‚Ğ¸Ğ²Ğ½Ğ°**\n`;
    message += `ğŸ“… Ğ”Ğ½ĞµĞ¹ Ğ´Ğ¾ Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ: ${userInfo.daysLeft}\n`;
    if (userInfo.subscriptionEndDate) {
      const endDate = new Date(userInfo.subscriptionEndDate);
      message += `ğŸ“† Ğ”Ğ°Ñ‚Ğ° Ğ¾ĞºĞ¾Ğ½Ñ‡Ğ°Ğ½Ğ¸Ñ: ${endDate.toLocaleDateString('ru-RU')}\n`;
    }
  } else {
    message += `âŒ **ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ¾Ñ‚ÑÑƒÑ‚ÑÑ‚Ğ²ÑƒĞµÑ‚**\n`;
  }

  message += `\nğŸ“… Ğ”Ğ°Ñ‚Ğ° Ñ€ĞµĞ³Ğ¸ÑÑ‚Ñ€Ğ°Ñ†Ğ¸Ğ¸: ${new Date(userInfo.createdAt).toLocaleDateString('ru-RU')}`;

  return message;
};

/**
 * ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ
 */
export const handleGetUserInfo = async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.reply(
    'ğŸ“ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ username Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ (Ğ½Ğ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: @username Ğ¸Ğ»Ğ¸ username):',
    {
      reply_markup: {
        inline_keyboard: [
          [{ text: 'âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°', callback_data: 'admin_cancel' }]
        ]
      }
    }
  );

  return 'admin_awaiting_username_info';
};

/**
 * ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
 */
export const handleSetFreeRequests = async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.reply(
    'ğŸ“ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ username Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»:\n' +
    'ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: @username 10',
    {
      reply_markup: {
        inline_keyboard: [
          [{ text: 'âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°', callback_data: 'admin_cancel' }]
        ]
      }
    }
  );

  return 'admin_awaiting_free_requests';
};

/**
 * ĞĞ±Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñ‡Ğ¸Ğº ĞºĞ¾Ğ¼Ğ°Ğ½Ğ´Ñ‹ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
 */
export const handleSetSubscription = async (ctx) => {
  await ctx.answerCbQuery();
  await ctx.reply(
    'ğŸ“ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ username Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ Ğ¸ ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸ Ñ‡ĞµÑ€ĞµĞ· Ğ¿Ñ€Ğ¾Ğ±ĞµĞ»:\n' +
    'ĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: @username 30',
    {
      reply_markup: {
        inline_keyboard: [
          [{ text: 'âŒ ĞÑ‚Ğ¼ĞµĞ½Ğ°', callback_data: 'admin_cancel' }]
        ]
      }
    }
  );

  return 'admin_awaiting_subscription';
};

/**
 * ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²Ğ²Ğ¾Ğ´ username Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ñ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸
 */
export const processGetUserInfo = async (ctx, text, databaseServiceUrl) => {
  const username = text.trim().replace('@', '');

  if (!username) {
    await ctx.reply('âŒ Username Ğ½Ğµ Ğ¼Ğ¾Ğ¶ĞµÑ‚ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿ÑƒÑÑ‚Ñ‹Ğ¼. ĞŸĞ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°.');
    return;
  }

  try {
    const userInfo = await getUserInfoFromAPI(databaseServiceUrl, username);

    if (!userInfo) {
      await ctx.reply(`âŒ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ @${username} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….`);
      return;
    }

    const message = formatUserInfo(userInfo);
    await ctx.reply(message, {
      parse_mode: 'Markdown',
      reply_markup: getAdminMainKeyboard().reply_markup
    });
  } catch (error) {
    console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ:', error);
    await ctx.reply('âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸ Ğ¸Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ğ¸Ğ¸ Ğ¾ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğµ.');
  }
};

/**
 * ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²Ğ²Ğ¾Ğ´ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²
 */
export const processSetFreeRequests = async (ctx, text, databaseServiceUrl) => {
  const parts = text.trim().split(/\s+/);

  if (parts.length < 2) {
    await ctx.reply('âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ: @username ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾\nĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: @username 10');
    return;
  }

  const username = parts[0].replace('@', '');
  const count = parseInt(parts[1], 10);

  if (isNaN(count) || count < 0) {
    await ctx.reply('âŒ ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼.');
    return;
  }

  try {
    const response = await axios.put(
      `${databaseServiceUrl}/users/username/${username}/free-requests`,
      { count },
      { timeout: 10000 }
    );

    const user = response.data.user;
    if (!user) {
      await ctx.reply(`âŒ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ @${username} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….`);
      return;
    }

    await ctx.reply(
      `âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾ ${count} Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ² Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ @${username}`,
      { reply_markup: getAdminMainKeyboard().reply_markup }
    );
  } catch (error) {
    if (error.response?.status === 404) {
      await ctx.reply(`âŒ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ @${username} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….`);
    } else {
      console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ²:', error);
      await ctx.reply('âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ ÑƒÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞµ Ğ±ĞµÑĞ¿Ğ»Ğ°Ñ‚Ğ½Ñ‹Ñ… Ğ·Ğ°Ğ¿Ñ€Ğ¾ÑĞ¾Ğ².');
    }
  }
};

/**
 * ĞĞ±Ñ€Ğ°Ğ±Ğ°Ñ‚Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ²Ğ²Ğ¾Ğ´ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸
 */
export const processSetSubscription = async (ctx, text, databaseServiceUrl) => {
  const parts = text.trim().split(/\s+/);

  if (parts.length < 2) {
    await ctx.reply('âŒ ĞĞµĞ²ĞµÑ€Ğ½Ñ‹Ğ¹ Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ‚. Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞ¹Ñ‚Ğµ: @username ĞºĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾_Ğ´Ğ½ĞµĞ¹\nĞĞ°Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€: @username 30');
    return;
  }

  const username = parts[0].replace('@', '');
  const days = parseInt(parts[1], 10);

  if (isNaN(days) || days <= 0) {
    await ctx.reply('âŒ ĞšĞ¾Ğ»Ğ¸Ñ‡ĞµÑÑ‚Ğ²Ğ¾ Ğ´Ğ½ĞµĞ¹ Ğ´Ğ¾Ğ»Ğ¶Ğ½Ğ¾ Ğ±Ñ‹Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ¾Ğ¶Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ñ‹Ğ¼ Ñ‡Ğ¸ÑĞ»Ğ¾Ğ¼.');
    return;
  }

  try {
    const response = await axios.put(
      `${databaseServiceUrl}/users/username/${username}/subscription`,
      { days },
      { timeout: 10000 }
    );

    const user = response.data.user;
    if (!user) {
      await ctx.reply(`âŒ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ @${username} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….`);
      return;
    }

    const endDate = new Date(user.subscription_end_date);
    await ctx.reply(
      `âœ… Ğ£ÑĞ¿ĞµÑˆĞ½Ğ¾ Ğ²Ñ‹Ğ´Ğ°Ğ½Ğ° Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ½Ğ° ${days} Ğ´Ğ½ĞµĞ¹ Ğ´Ğ»Ñ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ @${username}\n` +
      `ğŸ“… ĞŸĞ¾Ğ´Ğ¿Ğ¸ÑĞºĞ° Ğ´ĞµĞ¹ÑÑ‚Ğ²Ğ¸Ñ‚ĞµĞ»ÑŒĞ½Ğ° Ğ´Ğ¾: ${endDate.toLocaleDateString('ru-RU')}`,
      { reply_markup: getAdminMainKeyboard().reply_markup }
    );
  } catch (error) {
    if (error.response?.status === 404) {
      await ctx.reply(`âŒ ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ @${username} Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½ Ğ² Ğ±Ğ°Ğ·Ğµ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ….`);
    } else {
      console.error('ĞÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸:', error);
      await ctx.reply('âŒ ĞŸÑ€Ğ¾Ğ¸Ğ·Ğ¾ÑˆĞ»Ğ° Ğ¾ÑˆĞ¸Ğ±ĞºĞ° Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğµ Ğ¿Ğ¾Ğ´Ğ¿Ğ¸ÑĞºĞ¸.');
    }
  }
};

export { ADMIN_USERNAMES_STRING };
